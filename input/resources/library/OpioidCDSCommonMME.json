{
  "resourceType": "Library",
  "id": "OpioidCDSCommonMME",
  "extension": [ {
    "url": "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-softwaresystem",
    "valueReference": {
      "reference": "cqf-tooling"
    }
  } ],
  "url": "http://fhir.org/guides/cdc/opioid-cds/Library/OpioidCDSCommonMME",
  "version": "2.0.1",
  "name": "OpioidCDSCommonMME",
  "title": "Library - OpioidCDS Common MME",
  "status": "active",
  "experimental": true,
  "type": {
    "coding": [ {
      "system": "http://terminology.hl7.org/CodeSystem/library-type",
      "code": "logic-library"
    } ]
  },
  "content": [ {
    "contentType": "text/cql",
    "data": "bGlicmFyeSBPcGlvaWRDRFNDb21tb25NTUUgdmVyc2lvbiAnMi4wLjEnCgp1c2luZyBGSElSIHZlcnNpb24gJzQuMC4xJwoKaW5jbHVkZSBGSElSSGVscGVycyB2ZXJzaW9uICc0LjAuMScgY2FsbGVkIEZISVJIZWxwZXJzCmluY2x1ZGUgT01US0xvZ2ljTUsyMDIwIHZlcnNpb24gJzIuMC4xJyBjYWxsZWQgT01US0xvZ2ljCmluY2x1ZGUgT3Bpb2lkQ0RTQ29tbW9uIHZlcnNpb24gJzIuMC4xJyBjYWxsZWQgQ29tbW9uCgpjb250ZXh0IFBhdGllbnQKCmRlZmluZSBmdW5jdGlvbiBQcmVzY3JpcHRpb25zKE9yZGVycyBMaXN0PE1lZGljYXRpb25SZXF1ZXN0Pik6CiAgT3JkZXJzIE8KICAgIGxldAogICAgICAvLyBOT1RFOiBBc3N1bWluZyBtZWRpY2F0aW9uIGlzIHNwZWNpZmllZCBhcyBhIENvZGVhYmxlQ29uY2VwdCB3aXRoIGEgc2luZ2xlIFJ4Tm9ybSBjb2RlCiAgICAgIHJ4Tm9ybUNvZGU6IEZISVJIZWxwZXJzLlRvQ29kZSgoTy5tZWRpY2F0aW9uIGFzIEZISVIuQ29kZWFibGVDb25jZXB0KS5jb2RpbmdbMF0pLAogICAgICBtZWRpY2F0aW9uTmFtZTogT01US0xvZ2ljLkdldE1lZGljYXRpb25OYW1lKHJ4Tm9ybUNvZGUpLAogICAgICAvLyBOT1RFOiBBc3N1bWluZyBhIHNpbmdsZSBkb3NhZ2UgaW5zdHJ1Y3Rpb24gZWxlbWVudAogICAgICBkb3NhZ2VJbnN0cnVjdGlvbjogTy5kb3NhZ2VJbnN0cnVjdGlvblswXSwKICAgICAgLy8gTk9URTogQXNzdW1pbmcgYSBzaW5nbGUgZG9zZSBhbmQgcmF0ZSBlbGVtZW50CiAgICAgIGRvc2VBbmRSYXRlOiBkb3NhZ2VJbnN0cnVjdGlvbi5kb3NlQW5kUmF0ZVswXSwKICAgICAgcmVwZWF0OiBkb3NhZ2VJbnN0cnVjdGlvbi50aW1pbmcucmVwZWF0LAogICAgICBmcmVxdWVuY3k6IENvYWxlc2NlKHJlcGVhdC5mcmVxdWVuY3lNYXgudmFsdWUsIHJlcGVhdC5mcmVxdWVuY3kudmFsdWUpLAogICAgICBwZXJpb2Q6IFN5c3RlbS5RdWFudGl0eSB7IHZhbHVlOiByZXBlYXQucGVyaW9kLnZhbHVlLCB1bml0OiByZXBlYXQucGVyaW9kVW5pdC52YWx1ZSB9LAogICAgICBkb3NlRGVzY3JpcHRpb246CiAgICAgICAgQ29hbGVzY2UoCiAgICAgICAgICAvLyBUaGVyZSBzaG91bGQgYmUgYSBjb252ZXJzaW9uIGZyb20gRkhJUi5TaW1wbGVRdWFudGl0eSB0byBTeXN0ZW0uUXVhbnRpdHkKICAgICAgICAgIGlmIGRvc2VBbmRSYXRlLmRvc2UgaXMgRkhJUi5SYW5nZQogICAgICAgICAgICB0aGVuIFRvU3RyaW5nKChkb3NlQW5kUmF0ZS5kb3NlIGFzIEZISVIuUmFuZ2UpLmxvdykKICAgICAgICAgICAgICAgICsgJy0nICsgVG9TdHJpbmcoKGRvc2VBbmRSYXRlLmRvc2UgYXMgRkhJUi5SYW5nZSkuaGlnaCkKICAgICAgICAgICAgICAgICsgKGRvc2VBbmRSYXRlLmRvc2UgYXMgRkhJUi5SYW5nZSkuaGlnaC51bml0LnZhbHVlCiAgICAgICAgICAgIGVsc2UgVG9TdHJpbmcoRkhJUkhlbHBlcnMuVG9RdWFudGl0eShkb3NlQW5kUmF0ZS5kb3NlIGFzIEZISVIuU2ltcGxlUXVhbnRpdHkpKSwKICAgICAgICAgICAgJycKICAgICAgICApLAogICAgICBmcmVxdWVuY3lEZXNjcmlwdGlvbjoKICAgICAgICBUb1N0cmluZyhkb3NhZ2VJbnN0cnVjdGlvbi50aW1pbmcucmVwZWF0LmZyZXF1ZW5jeS52YWx1ZSkgKwogICAgICAgICAgQ29hbGVzY2UoCiAgICAgICAgICAgICctJyArIFRvU3RyaW5nKGRvc2FnZUluc3RydWN0aW9uLnRpbWluZy5yZXBlYXQuZnJlcXVlbmN5TWF4LnZhbHVlKSwKICAgICAgICAgICAgJycKICAgICAgICAgICkKICAgIHJldHVybiB7CiAgICAgIHJ4Tm9ybUNvZGU6IHJ4Tm9ybUNvZGUsCiAgICAgIGlzRHJhZnQ6IE8uc3RhdHVzLnZhbHVlID0gJ2RyYWZ0JywKICAgICAgLy8gTk9URTogQXNzdW1pbmcgYXNOZWVkZWQgaXMgZXhwcmVzc2VkIGFzIGEgYm9vbGVhbgogICAgICBpc1BSTjogZG9zYWdlSW5zdHJ1Y3Rpb24uYXNOZWVkZWQsCiAgICAgIHByZXNjcmlwdGlvbjoKICAgICAgICBpZiBkb3NhZ2VJbnN0cnVjdGlvbi50ZXh0IGlzIG5vdCBudWxsIHRoZW4KICAgICAgICAgIG1lZGljYXRpb25OYW1lICsgJyAnICsgZG9zYWdlSW5zdHJ1Y3Rpb24udGV4dC52YWx1ZQogICAgICAgIGVsc2UKICAgICAgICAgIC8vIFRPRE86IFNob3VsZG4ndCBuZWVkIHRoZSAudmFsdWUgaGVyZSBvbiBhc05lZWRlZEJvb2xlYW4KICAgICAgICAgIG1lZGljYXRpb25OYW1lICsgJyAnICsgZG9zZURlc2NyaXB0aW9uICsgJyBxJyArIGZyZXF1ZW5jeURlc2NyaXB0aW9uICsgKGlmIGRvc2FnZUluc3RydWN0aW9uLmFzTmVlZGVkIHRoZW4gJyBQUk4nIGVsc2UgJycpLAogICAgICBkb3NlOiBpZiBkb3NlQW5kUmF0ZS5kb3NlIGlzIEZISVIuUmFuZ2UKICAgICAgICAgICAgdGhlbiAoZG9zZUFuZFJhdGUuZG9zZSBhcyBGSElSLlJhbmdlKS5oaWdoCiAgICAgICAgICAgIGVsc2UgRkhJUkhlbHBlcnMuVG9RdWFudGl0eShkb3NlQW5kUmF0ZS5kb3NlIGFzIEZISVIuU2ltcGxlUXVhbnRpdHkpLAogICAgICBkb3Nlc1BlckRheTogQ29hbGVzY2UoT01US0xvZ2ljLlRvRGFpbHkoZnJlcXVlbmN5LCBwZXJpb2QpLCAxLjApCiAgICB9CgpkZWZpbmUgZnVuY3Rpb24gTU1FKHByZXNjcmlwdGlvbnMgTGlzdDxNZWRpY2F0aW9uUmVxdWVzdD4pOgogIChQcmVzY3JpcHRpb25zKHByZXNjcmlwdGlvbnMpKSBQCiAgICBsZXQgbW1lOiBTaW5nbGV0b25Gcm9tKE9NVEtMb2dpYy5DYWxjdWxhdGVNTUVzKHsgeyByeE5vcm1Db2RlOiBQLnJ4Tm9ybUNvZGUsIGRvc2VRdWFudGl0eTogUC5kb3NlLCBkb3Nlc1BlckRheTogUC5kb3Nlc1BlckRheSB9IH0pKQogICAgcmV0dXJuIHsKICAgICAgcnhOb3JtQ29kZTogUC5yeE5vcm1Db2RlLAogICAgICBpc0RyYWZ0OiBQLmlzRHJhZnQsCiAgICAgIGlzUFJOOiBQLmlzUFJOLAogICAgICBwcmVzY3JpcHRpb246IFAucHJlc2NyaXB0aW9uLAogICAgICBkYWlseURvc2U6IG1tZS5kYWlseURvc2VEZXNjcmlwdGlvbiwKICAgICAgY29udmVyc2lvbkZhY3RvcjogbW1lLmNvbnZlcnNpb25GYWN0b3IsCiAgICAgIG1tZTogbW1lLm1tZQogICAgfQoKZGVmaW5lIGZ1bmN0aW9uIFRvdGFsTU1FKHByZXNjcmlwdGlvbnMgTGlzdDxNZWRpY2F0aW9uUmVxdWVzdD4pOgogIFN5c3RlbS5RdWFudGl0eSB7CiAgICB2YWx1ZTogU3VtKChNTUUocHJlc2NyaXB0aW9ucykpIE0gcmV0dXJuIE0ubW1lLnZhbHVlKSwKICAgIHVuaXQ6ICdtZy9kJwogIH0KCmRlZmluZSBmdW5jdGlvbiBHZXRJbmdyZWRpZW50KHJ4Tm9ybUNvZGUgQ29kZSk6CiAgT01US0xvZ2ljLkdldEluZ3JlZGllbnRzKHJ4Tm9ybUNvZGUpLmluZ3JlZGllbnROYW1lCgpkZWZpbmUgZnVuY3Rpb24gR2V0SW5ncmVkaWVudHMocnhOb3JtQ29kZXMgTGlzdDxDb2RlPik6CiAgcnhOb3JtQ29kZXMgcm5jIHJldHVybiBHZXRJbmdyZWRpZW50KHJuYykK"
  } ]
}