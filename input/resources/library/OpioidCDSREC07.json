{
  "resourceType": "Library",
  "id": "OpioidCDSREC07",
  "text": {
    "status": "generated",
    "div": "<div xmlns=\"http://www.w3.org/1999/xhtml\"><table class=\"grid dict\"><tr><th scope=\"row\"><b>Id: </b></th><td style=\"padding-left: 25px; padding-right: 25px;\">library-OpioidCDSREC07</td></tr><tr><th scope=\"row\"><b>Type: </b></th><td style=\"padding-right: 25px;\"> logic-library </td></tr><tr><th scope=\"row\"><b>Version: </b></th><td style=\"padding-left: 25px; padding-right: 25px;\">0.1.1</td></tr><tr><th scope=\"row\"><b>Status: </b></th><td style=\"padding-left: 25px; padding-right: 25px;\">active</td></tr><tr style=\"vertical-align: top;\"><th rowspan=\"3\" scope=\"row\"><b>Related: </b></th><td style=\"padding-left: 25px; padding-right: 25px;\"><p style=\"margin-bottom: 5px;\"><b>type: </b><span>depends-on</span></p><p style=\"margin-bottom: 5px;\"><b>Resource: </b><br/><span>http://fhir.org/guides/cdc/opioid-cds/Library/FHIRHelpers</span></p></td></tr><tr style=\"vertical-align: top;\"><td style=\"padding-left: 25px; padding-right: 25px;\"><p style=\"margin-bottom: 5px;\"><b>type: </b><span>depends-on</span></p><p style=\"margin-bottom: 5px;\"><b>Resource: </b><br/><span>http://fhir.org/guides/cdc/opioid-cds/Library/OpioidCDSCommon</span></p></td></tr><tr style=\"vertical-align: top;\"><td style=\"padding-left: 25px; padding-right: 25px;\"><p style=\"margin-bottom: 5px;\"><b>type: </b><span>depends-on</span></p><p style=\"margin-bottom: 5px;\"><b>Resource: </b><br/><span>http://fhir.org/guides/cdc/opioid-cds/Library/OpioidCDSRoutines</span></p></td></tr><tr style=\"vertical-align: top;\"><th rowspan=\"2\" scope=\"row\"><b>Data Requirements: </b></th><td style=\"padding-left: 25px; padding-right: 25px;\"><div><p style=\"margin-bottom: 5px;\"><b>type: </b><span>Procedure</span></p><p style=\"margin-bottom: 5px;\"><b>code filter:</b><br/><span style=\"padding-left: 25px;\"><b>path: </b><span>code</span></span><br/><span style=\"padding-left: 25px;\"><b>valueset: </b><span>http://fhir.org/guides/cdc/opioid-cds/ValueSet/opioid-misuse-assessment-procedure</span></span></p></div></td></tr><tr style=\"vertical-align: top;\"><td style=\"padding-left: 25px; padding-right: 25px;\"><div><p style=\"margin-bottom: 5px;\"><b>type: </b><span>Encounter</span></p><p style=\"margin-bottom: 5px;\"><b>code filter:</b><br/><span style=\"padding-left: 25px;\"><b>path: </b><span>type</span></span><br/><span style=\"padding-left: 25px;\"><b>valueset: </b><span>http://fhir.org/guides/cdc/opioid-cds/ValueSet/office-visit</span></span></p></div></td></tr><tr style=\"vertical-align: top;\"><th scope=\"row\"><b>Content: </b></th><td style=\"padding-left: 25px; padding-right: 25px;\"><b>type: </b><span>text/cql</span></td></tr><tr><td colspan=\"2\" style=\"padding-left: 25px; padding-right: 25px;\"><pre><code class=\"language-cql\">library OpioidCDSREC07 version '0.1.1'\n\nusing FHIR version '4.0.1'\n\ninclude FHIRHelpers version '4.0.1' called FHIRHelpers\ninclude OpioidCDSCommon version '0.1.1' called Common\ninclude OpioidCDSRoutines version '0.1.1' called Routines\n\n/*\n**\n**  Recommendation #7\n**    Clinicians should evaluate benefits and harms with patients within 1 to 4\n**    weeks of starting opioid therapy for chronic pain or of dose escalation.\n**    Clinicians should evaluate benefits and harms of continued therapy with\n**    patients every 3 months or more frequently. If benefits do not outweigh\n**    harms of continued opioid therapy, clinicians should optimize other\n**    therapies and work with patients to taper opioids to lower dosages or to\n**    taper and discontinue opioids (recommendation category: A, evidence type: 4)\n**\n**  When\n**    Provider is prescribing an opioid analgesic with ambulatory misuse potential in the outpatient setting\n**    Prescription is for treating chronic pain.\n**    Opioid review is useful for this patient:\n**      Patient is 18 or over\n**      Patient does not have findings indicating limited life expectancy\n**      Patient does not have orders for therapies indicating end of life care\n**      Patient is not undergoing active cancer treatment:\n**        Patient has had at least 2 encounters within the past year with any diagnosis of cancer\n**    Patient has not undergone an opioid misuse assessment procedure in the last 90 days\n**  Then\n**    Recommend performing opioid misuse assessment\n**      Will schedule opioid misuse assessment\n**      Benefits outweigh risks, snooze 3 months\n**      N/A - see comment, snooze 3 months\n**\n*/\n\n// META: Plan Definition: http://fhir.org/guides/cdc/opioid-cds-r4/PlanDefinition/opioid-cds-07\n\nparameter ContextPrescriptions List&lt;MedicationRequest&gt;\n\ncontext Patient\n\ndefine &quot;Risk Assessment Interval&quot;:\n  Interval[Today() - 91 days, Today() - 1 day]\n\ndefine &quot;Previous 10 Days Interval&quot;:\n  Interval[Today() - 10 days, Today()]\n\ndefine &quot;Encounter Interval&quot;:\n  Interval[Today() - 12 months - 1 days, Today() - 1 day]\n\ndefine &quot;Chronic Pain Opioid Analgesic with Ambulatory Misuse Potential Prescriptions&quot;:\n  ( Common.&quot;Is Opioid Analgesic with Ambulatory Misuse Potential?&quot;( ContextPrescriptions ) ) AmbulatoryOpioidPrescription\n    where Routines.&quot;Is Acute Pain Prescription?&quot;( AmbulatoryOpioidPrescription )\n\ndefine &quot;Patient Is Being Prescribed Opioid Analgesic with Ambulatory Misuse Potential&quot;:\n  exists( &quot;Chronic Pain Opioid Analgesic with Ambulatory Misuse Potential Prescriptions&quot; )\n\ndefine &quot;Is Recommendation Applicable?&quot;:\n  &quot;Inclusion Criteria&quot;\n    and not &quot;Exclusion Criteria&quot;\n\ndefine &quot;Inclusion Criteria&quot;:\n  &quot;Patient Is Being Prescribed Opioid Analgesic with Ambulatory Misuse Potential&quot;\n    and Routines.&quot;Is Opioid Review Useful?&quot;\n    and not exists ( &quot;Opioid Risk Assessment in Past 90 Days&quot; )\n    and (\n      &quot;Prescribed Opioids for 7 of Past 10 Days with an Encounter&quot;\n        or Common.&quot;Prescribed Opioids for 21 or more of 30 Days for each of the past 3 Months&quot;\n    )\n\ndefine &quot;Exclusion Criteria&quot;:\n  Common.&quot;End of Life Assessment&quot;\n\ndefine &quot;Opioid Risk Assessment in Past 90 Days&quot;:\n  [Procedure: Common.&quot;Opioid misuse assessment procedure&quot;] riskAssessment\n    where start of (riskAssessment.performed as FHIR.Period) in day of &quot;Risk Assessment Interval&quot;\n\ndefine &quot;Prescribed Opioids for 7 of Past 10 Days with an Encounter&quot;:\n  Common.&quot;Days on Opioids during Period&quot;( &quot;Previous 10 Days Interval&quot; ) &gt;= 7\n    and exists (\n      [Encounter: Common.&quot;Office Visit&quot;] AmbulatoryEncounter\n        where AmbulatoryEncounter.period during &quot;Encounter Interval&quot;\n    )\n\ndefine &quot;Get Indicator&quot;:\n  if &quot;Is Recommendation Applicable?&quot;\n    then 'warning'\n  else null\n\ndefine &quot;Get Summary&quot;:\n  if &quot;Is Recommendation Applicable?&quot;\n    then 'Patients on opioid therapy should be evaluated for benefits and harms within 1 to 4 weeks of starting opioid therapy and every 3 months or more subsequently.'\n  else null\n\ndefine &quot;Get Detail&quot;:\n  if &quot;Is Recommendation Applicable?&quot;\n    then\n      if Common.&quot;Prescribed Opioids for 21 or more of 30 Days for each of the past 3 Months&quot;\n        then 'No evaluation for benefits and harms associated with opioid therapy has been performed for the patient in the past 3 months'\n      else 'No evaluation for benefits and harms has been performed for the patient starting opioid therapy'\n  else null\n</code></pre>\n                    \n                    \n                </td>\n            </tr>\n        \n    </table>\n</div>"
  },
  "extension": [ {
    "url": "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-softwaresystem",
    "valueReference": {
      "reference": "Device/cqf-tooling"
    }
  }, {
    "url": "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-softwaresystem",
    "valueReference": {
      "reference": "Device/cqf-tooling"
    }
  } ],
  "url": "http://fhir.org/guides/cdc/opioid-cds/Library/OpioidCDSREC07",
  "version": "0.1.1",
  "name": "OpioidCDSREC07",
  "title": "Library - Recommendation #7 - Opioid Therapy Risk Assessment",
  "status": "active",
  "experimental": true,
  "type": {
    "coding": [ {
      "system": "http://terminology.hl7.org/CodeSystem/library-type",
      "code": "logic-library"
    } ]
  },
  "content": [ {
    "contentType": "text/cql",
    "data": "bGlicmFyeSBPcGlvaWRDRFNSRUMwNyB2ZXJzaW9uICcwLjEuMScKCnVzaW5nIEZISVIgdmVyc2lvbiAnNC4wLjEnCgppbmNsdWRlIEZISVJIZWxwZXJzIHZlcnNpb24gJzQuMC4xJyBjYWxsZWQgRkhJUkhlbHBlcnMKaW5jbHVkZSBPcGlvaWRDRFNDb21tb24gdmVyc2lvbiAnMC4xLjEnIGNhbGxlZCBDb21tb24KaW5jbHVkZSBPcGlvaWRDRFNDb21tb25Db25maWcgdmVyc2lvbiAnMC4xLjEnIGNhbGxlZCBDb25maWcKaW5jbHVkZSBPcGlvaWRDRFNSb3V0aW5lcyB2ZXJzaW9uICcwLjEuMScgY2FsbGVkIFJvdXRpbmVzCgovKgoqKgoqKiAgUmVjb21tZW5kYXRpb24gIzcKKiogICAgQ2xpbmljaWFucyBzaG91bGQgZXZhbHVhdGUgYmVuZWZpdHMgYW5kIGhhcm1zIHdpdGggcGF0aWVudHMgd2l0aGluIDEgdG8gNAoqKiAgICB3ZWVrcyBvZiBzdGFydGluZyBvcGlvaWQgdGhlcmFweSBmb3IgY2hyb25pYyBwYWluIG9yIG9mIGRvc2UgZXNjYWxhdGlvbi4KKiogICAgQ2xpbmljaWFucyBzaG91bGQgZXZhbHVhdGUgYmVuZWZpdHMgYW5kIGhhcm1zIG9mIGNvbnRpbnVlZCB0aGVyYXB5IHdpdGgKKiogICAgcGF0aWVudHMgZXZlcnkgMyBtb250aHMgb3IgbW9yZSBmcmVxdWVudGx5LiBJZiBiZW5lZml0cyBkbyBub3Qgb3V0d2VpZ2gKKiogICAgaGFybXMgb2YgY29udGludWVkIG9waW9pZCB0aGVyYXB5LCBjbGluaWNpYW5zIHNob3VsZCBvcHRpbWl6ZSBvdGhlcgoqKiAgICB0aGVyYXBpZXMgYW5kIHdvcmsgd2l0aCBwYXRpZW50cyB0byB0YXBlciBvcGlvaWRzIHRvIGxvd2VyIGRvc2FnZXMgb3IgdG8KKiogICAgdGFwZXIgYW5kIGRpc2NvbnRpbnVlIG9waW9pZHMgKHJlY29tbWVuZGF0aW9uIGNhdGVnb3J5OiBBLCBldmlkZW5jZSB0eXBlOiA0KQoqKgoqKiAgV2hlbgoqKiAgICBQcm92aWRlciBpcyBwcmVzY3JpYmluZyBhbiBvcGlvaWQgYW5hbGdlc2ljIHdpdGggYW1idWxhdG9yeSBtaXN1c2UgcG90ZW50aWFsIGluIHRoZSBvdXRwYXRpZW50IHNldHRpbmcKKiogICAgUHJlc2NyaXB0aW9uIGlzIGZvciB0cmVhdGluZyBjaHJvbmljIHBhaW4uCioqICAgIE9waW9pZCByZXZpZXcgaXMgdXNlZnVsIGZvciB0aGlzIHBhdGllbnQ6CioqICAgICAgUGF0aWVudCBpcyAxOCBvciBvdmVyCioqICAgICAgUGF0aWVudCBkb2VzIG5vdCBoYXZlIGZpbmRpbmdzIGluZGljYXRpbmcgbGltaXRlZCBsaWZlIGV4cGVjdGFuY3kKKiogICAgICBQYXRpZW50IGRvZXMgbm90IGhhdmUgb3JkZXJzIGZvciB0aGVyYXBpZXMgaW5kaWNhdGluZyBlbmQgb2YgbGlmZSBjYXJlCioqICAgICAgUGF0aWVudCBpcyBub3QgdW5kZXJnb2luZyBhY3RpdmUgY2FuY2VyIHRyZWF0bWVudDoKKiogICAgICAgIFBhdGllbnQgaGFzIGhhZCBhdCBsZWFzdCAyIGVuY291bnRlcnMgd2l0aGluIHRoZSBwYXN0IHllYXIgd2l0aCBhbnkgZGlhZ25vc2lzIG9mIGNhbmNlcgoqKiAgICBQYXRpZW50IGhhcyBub3QgdW5kZXJnb25lIGFuIG9waW9pZCBtaXN1c2UgYXNzZXNzbWVudCBwcm9jZWR1cmUgaW4gdGhlIGxhc3QgOTAgZGF5cwoqKiAgVGhlbgoqKiAgICBSZWNvbW1lbmQgcGVyZm9ybWluZyBvcGlvaWQgbWlzdXNlIGFzc2Vzc21lbnQKKiogICAgICBXaWxsIHNjaGVkdWxlIG9waW9pZCBtaXN1c2UgYXNzZXNzbWVudAoqKiAgICAgIEJlbmVmaXRzIG91dHdlaWdoIHJpc2tzLCBzbm9vemUgMyBtb250aHMKKiogICAgICBOL0EgLSBzZWUgY29tbWVudCwgc25vb3plIDMgbW9udGhzCioqCiovCgovLyBNRVRBOiBQbGFuIERlZmluaXRpb246IGh0dHA6Ly9maGlyLm9yZy9ndWlkZXMvY2RjL29waW9pZC1jZHMtcjQvUGxhbkRlZmluaXRpb24vb3Bpb2lkLWNkcy0wNwoKcGFyYW1ldGVyIENvbnRleHRQcmVzY3JpcHRpb25zIExpc3Q8TWVkaWNhdGlvblJlcXVlc3Q+Cgpjb250ZXh0IFBhdGllbnQKCmRlZmluZSAiUmlzayBBc3Nlc3NtZW50IEludGVydmFsIjoKICBJbnRlcnZhbFtUb2RheSgpIC0gOTEgZGF5cywgVG9kYXkoKSAtIDEgZGF5XQoKZGVmaW5lICJQcmV2aW91cyAxMCBEYXlzIEludGVydmFsIjoKICBJbnRlcnZhbFtUb2RheSgpIC0gMTAgZGF5cywgVG9kYXkoKV0KCmRlZmluZSAiRW5jb3VudGVyIEludGVydmFsIjoKICBJbnRlcnZhbFtUb2RheSgpIC0gMTIgbW9udGhzIC0gMSBkYXlzLCBUb2RheSgpIC0gMSBkYXldCgpkZWZpbmUgIkNocm9uaWMgUGFpbiBPcGlvaWQgQW5hbGdlc2ljIHdpdGggQW1idWxhdG9yeSBNaXN1c2UgUG90ZW50aWFsIFByZXNjcmlwdGlvbnMiOgogICggQ29tbW9uLiJJcyBPcGlvaWQgQW5hbGdlc2ljIHdpdGggQW1idWxhdG9yeSBNaXN1c2UgUG90ZW50aWFsPyIoIENvbnRleHRQcmVzY3JpcHRpb25zICkgKSBBbWJ1bGF0b3J5T3Bpb2lkUHJlc2NyaXB0aW9uCiAgICB3aGVyZSBSb3V0aW5lcy4iSXMgU3ViYWN1dGUgb3IgQ2hyb25pYyBQYWluIFByZXNjcmlwdGlvbj8iKCBBbWJ1bGF0b3J5T3Bpb2lkUHJlc2NyaXB0aW9uICkKCmRlZmluZSAiUGF0aWVudCBJcyBCZWluZyBQcmVzY3JpYmVkIE9waW9pZCBBbmFsZ2VzaWMgd2l0aCBBbWJ1bGF0b3J5IE1pc3VzZSBQb3RlbnRpYWwiOgogIGV4aXN0cyggIkNocm9uaWMgUGFpbiBPcGlvaWQgQW5hbGdlc2ljIHdpdGggQW1idWxhdG9yeSBNaXN1c2UgUG90ZW50aWFsIFByZXNjcmlwdGlvbnMiICkKCmRlZmluZSAiSXMgUmVjb21tZW5kYXRpb24gQXBwbGljYWJsZT8iOgogICJJbmNsdXNpb24gQ3JpdGVyaWEiCiAgICBhbmQgbm90ICJFeGNsdXNpb24gQ3JpdGVyaWEiCgpkZWZpbmUgIlBhdGllbnQgQWdlIExlc3MgVGhhbiAxOCI6CiAgaWYgKENvbmZpZy4iQWdlIExlc3MgdGhhbiAxOCBZZWFycyBJcyBFbmFibGVkIikgdGhlbgogICAgQWdlSW5ZZWFyc0F0KFRvZGF5KCkpIDwgMTgKICBlbHNlCiAgICBmYWxzZQoKZGVmaW5lICJJbmNsdXNpb24gQ3JpdGVyaWEiOgogICJQYXRpZW50IElzIEJlaW5nIFByZXNjcmliZWQgT3Bpb2lkIEFuYWxnZXNpYyB3aXRoIEFtYnVsYXRvcnkgTWlzdXNlIFBvdGVudGlhbCIKICAgIGFuZCBub3QgIlBhdGllbnQgQWdlIExlc3MgVGhhbiAxOCIgIAogICAgYW5kIFJvdXRpbmVzLiJJcyBPcGlvaWQgUmV2aWV3IFVzZWZ1bD8iCiAgICBhbmQgbm90IGV4aXN0cyAoICJPcGlvaWQgUmlzayBBc3Nlc3NtZW50IGluIFBhc3QgOTAgRGF5cyIgKQogICAgYW5kICgKICAgICAgIlByZXNjcmliZWQgT3Bpb2lkcyBmb3IgNyBvZiBQYXN0IDEwIERheXMgd2l0aCBhbiBFbmNvdW50ZXIiCiAgICAgICAgb3IgQ29tbW9uLiJQcmVzY3JpYmVkIE9waW9pZHMgZm9yIDIxIG9yIG1vcmUgb2YgMzAgRGF5cyBmb3IgZWFjaCBvZiB0aGUgcGFzdCAzIE1vbnRocyIKICAgICkKCmRlZmluZSAiRXhjbHVzaW9uIENyaXRlcmlhIjoKICBDb21tb24uIkVuZCBvZiBMaWZlIEFzc2Vzc21lbnQiCgpkZWZpbmUgIk9waW9pZCBSaXNrIEFzc2Vzc21lbnQgaW4gUGFzdCA5MCBEYXlzIjoKICBbUHJvY2VkdXJlOiBDb21tb24uIk9waW9pZCBtaXN1c2UgYXNzZXNzbWVudCBwcm9jZWR1cmUiXSByaXNrQXNzZXNzbWVudAogICAgd2hlcmUgc3RhcnQgb2YgKHJpc2tBc3Nlc3NtZW50LnBlcmZvcm1lZCBhcyBGSElSLlBlcmlvZCkgaW4gZGF5IG9mICJSaXNrIEFzc2Vzc21lbnQgSW50ZXJ2YWwiCgpkZWZpbmUgIlByZXNjcmliZWQgT3Bpb2lkcyBmb3IgNyBvZiBQYXN0IDEwIERheXMgd2l0aCBhbiBFbmNvdW50ZXIiOgogIENvbW1vbi4iRGF5cyBvbiBPcGlvaWRzIGR1cmluZyBQZXJpb2QiKCAiUHJldmlvdXMgMTAgRGF5cyBJbnRlcnZhbCIgKSA+PSA3CiAgICBhbmQgZXhpc3RzICgKICAgICAgW0VuY291bnRlcjogQ29tbW9uLiJPZmZpY2UgVmlzaXQiXSBBbWJ1bGF0b3J5RW5jb3VudGVyCiAgICAgICAgd2hlcmUgQW1idWxhdG9yeUVuY291bnRlci5wZXJpb2QgZHVyaW5nICJFbmNvdW50ZXIgSW50ZXJ2YWwiCiAgICApCgpkZWZpbmUgIkdldCBJbmRpY2F0b3IiOgogIGlmICJJcyBSZWNvbW1lbmRhdGlvbiBBcHBsaWNhYmxlPyIKICAgIHRoZW4gJ3dhcm5pbmcnCiAgZWxzZSBudWxsCgpkZWZpbmUgIkdldCBTdW1tYXJ5IjoKICBpZiAiSXMgUmVjb21tZW5kYXRpb24gQXBwbGljYWJsZT8iCiAgICB0aGVuICdQYXRpZW50cyBvbiBvcGlvaWQgdGhlcmFweSBzaG91bGQgYmUgZXZhbHVhdGVkIGZvciBiZW5lZml0cyBhbmQgaGFybXMgd2l0aGluIDEgdG8gNCB3ZWVrcyBvZiBzdGFydGluZyBvcGlvaWQgdGhlcmFweSBhbmQgZXZlcnkgMyBtb250aHMgb3IgbW9yZSBzdWJzZXF1ZW50bHkuJwogIGVsc2UgbnVsbAoKZGVmaW5lICJHZXQgRGV0YWlsIjoKICBpZiAiSXMgUmVjb21tZW5kYXRpb24gQXBwbGljYWJsZT8iCiAgICB0aGVuCiAgICAgIGlmIENvbW1vbi4iUHJlc2NyaWJlZCBPcGlvaWRzIGZvciAyMSBvciBtb3JlIG9mIDMwIERheXMgZm9yIGVhY2ggb2YgdGhlIHBhc3QgMyBNb250aHMiCiAgICAgICAgdGhlbiAnTm8gZXZhbHVhdGlvbiBmb3IgYmVuZWZpdHMgYW5kIGhhcm1zIGFzc29jaWF0ZWQgd2l0aCBvcGlvaWQgdGhlcmFweSBoYXMgYmVlbiBwZXJmb3JtZWQgZm9yIHRoZSBwYXRpZW50IGluIHRoZSBwYXN0IDMgbW9udGhzJwogICAgICBlbHNlICdObyBldmFsdWF0aW9uIGZvciBiZW5lZml0cyBhbmQgaGFybXMgaGFzIGJlZW4gcGVyZm9ybWVkIGZvciB0aGUgcGF0aWVudCBzdGFydGluZyBvcGlvaWQgdGhlcmFweScKICBlbHNlIG51bGwK"
  } ]
}